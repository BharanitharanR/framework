# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-java-with-maven

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Java CI with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 21
      uses: actions/setup-java@v3
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: maven
    - name: Build with Maven
      run: mvn -B package --file pom.xml
      
    - name: Codecov
    # You may pin to the exact commit or the version.
    # uses: codecov/codecov-action@428cda1b1c731be3e8bfa389049c3f276d572ffb
    uses: codecov/codecov-action@v4.0.0-beta.3
    with:
      # Repository upload token - get it from codecov.io. Required only for private repositories
      token: # optional
      # Path to coverage file to upload
      file: # optional
      # Comma-separated list of files to upload
      files: # optional
      # Directory to search for coverage reports.
      directory: # optional
      # Flag upload to group coverage metrics (e.g. unittests | integration | ui,chrome)
      flags: # optional
      # Don't upload files to Codecov
      dry_run: # optional
      # Environment variables to tag the upload with (e.g. PYTHON | OS,PYTHON)
      env_vars: # optional
      # Specify whether or not CI build should fail if Codecov runs into an error during upload
      fail_ci_if_error: # optional
      # Run with gcov support
      gcov: # optional
      # User defined upload name. Visible in Codecov UI
      name: # optional
      # Override the assumed OS. Options are linux | macos | windows.
      os: # optional
      # Specify the branch name
      override_branch: # optional
      # Specify the build number
      override_build: # optional
      # Specify the commit SHA
      override_commit: # optional
      # Specify the pull request number
      override_pr: # optional
      # Comma-separated list of plugins for use during upload.
      plugins: # optional
      # Used when not in git/hg project to identify project root directory
      root_dir: # optional
      # Specify the slug manually (Enterprise use)
      slug: # optional
      # Specify whether the Codecov output should be verbose
      verbose: # optional
      # Specify which version of the Codecov CLI should be used. Defaults to `latest`
      version: # optional
      # Directory in which to execute codecov.sh
      working-directory: # optional
                
    # Optional: Uploads the full dependency graph to GitHub to improve the quality of Dependabot alerts this repository can receive
    #- name: Update dependency graph
    #  uses: advanced-security/maven-dependency-submission-action@571e99aab1055c2e71a1e2309b9691de18d6b7d6
    - name: Upload coverage reports to Codecov
      uses: codecov/codecov-action@v3
      env:
        CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
